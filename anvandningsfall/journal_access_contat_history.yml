purpose: this use case aims to identify employees who have had contact with a patient but have not had any prior contact with the same patient in the last 6 months.
components: This use case leverages a collection of 'knowledge objects' (https://docs.splunk.com/Splexicon:Knowledgeobject), specifically 3 macros, 1 lookup, and 3 searches. 
requirements: 
- macros: pda_indexes, pda_sourcetypes, pda_sources
- fields: staff_ID, patient_ID
- lookups: contact_history
how_to_implemenet:
- create an index called 'anomaly' 
- create the field extractions for 'staff_ID' and 'patient_ID'
- create the three macros 'pda_indexes', 'pda_sourcetypes', and 'pda_sources'. Have them refer to the indexes, sourcetypes and sources that are used by the logs and events that fall under the Patient Data Act.
- create 'search 1', followed by 'search 2', followed by 'search 3'.
search 1: 
- description: establishes a baseline of contact history for the past 6 months.
- search: 
          `pda_indexes` `pda_sourcetypes` `pda_sources` earliest=-6mon
          | stats latest(_time) as last_contact count by staff_ID, patient_ID
          | fields staff_ID, patient_ID, last_contact
          | outputlookup contact_history
- cron schedule: N/A (run only once, that is, ad-hoc).
search 2: 
- description: incrementally updates the contact history daily.
- search:
          | inputlookup contact_history
          | append [
                    `pda_indexes` `pda_sourcetypes` `pda_sources` earliest=-1d@d latest=@d
                    | stats latest(_time) as last_contact count by staff_ID, patient_ID
                    | fields staff_ID, patient_ID, last_contact
                   ]
          | stats max(last_contact) as last_contact by staff_ID, patient_ID
          | fields staff_ID, patient_ID, last_contact
          | outputlookup contact_history
- cron schedule: 0 0 * * * (scheduled to run every day of the week at midnight).
search 3:
- description: identifies employees with no prior patient contact and triggers an anomaly for every single match.  
- search:
          `pda_indexes` `pda_sourcetypes` `pda_sources` earliest=-12min@min latest=-2min@min
          | stats count by staff_ID, patient_ID
          | lookup contact_history staff_ID patient_ID
          | eval no_history = if(isnull(last_contact), '1', '0')
          | where no_history = '1'
          | eval title = ''
          | eval description = ''
          | eval drilldown_search =  '`pda_indexes` `pda_sourcetypes` `pda_sources` staff_ID=$staff_ID$ patient_ID=$patient_ID$ earliest=$info_min_time$ latest=$info_max_time$'
          | fields title, description, drilldown_search, staff_ID, patient_ID
          | collect index=anomaly
- cron schedule: */10 * * * * (scheduled to run every 10th minute every day of the week).



